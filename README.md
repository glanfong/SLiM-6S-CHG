# SLiM-6S-CHG - (BTL/CST/EXP)

This repository contents are used to run the CHG (BTL/CST/EXP) simulations with the use of the SLiM simulator.

## Simulations

Three (3) different scenarii could be simulated with the contents of this repository.
The folders are organized as follow :

- *bin* folder : scripts used to run the simulations
- *sim* folder : sub-folders named *CHG-YMMDD-XXXX*
    - *CHG-YMMDD-XXXX* : metadata | *param* | *results*
        - *param* : prior.txt
        - *results* : simulations output
        
### *bin* folder - scripts

The *bin* folder contains the scripts used to run the simulations.
Here's a quick overview of each file :

- CHG-SIM.slim : it is the core script. It contains the SLiM code used to run the "forward part" of the simulations.
- dir_creat_CHG.bash : helper script used to create the sub-folders used for each "batch" of simulations.
- metadata_update.bash : helper script used to update the *metadata* file once the parameters are set in the *prior.txt* file.
- msmscalc_onePop.py : analysis script used to compute diversity indexes.
- prior_CHG.bash : helper script used to easily set the parameters used for the simulations.
- run_CHG.bash : helper script used to run the pipeline.
- sim2box.bash : helper script used to run *sim2box_single_YOLOv5.py* script.
- sim2box_single_YOLOv5.py : script used to create .png files containing diversity indexes.
- SLiM_CHG.bash : helper script used to run *CHG-SIM.slim* script using the correct parameters.
- stats_calc_CHG.bash : helper script used to run *trees2ms_CHG.py* and *msmscalc_onePop.py* scripts.
- tajD_check.r : temporary file - contains code extracts used to check tajD value of simulations with R.
- trees2ms_CHG.py : processing script used to recapitate (see pyslim - recapitation), add mutations and create a .ms file from the .trees files outputed by the SLiM simulations.
- treesTajimas_D.py : temporary file - script used to quickly compute TajD for all simulations.
- tskitTajD.bash : helper script used to run *treesTajimas_D.py* for all simulations within the *summary.txt* file.


- Note -
Computed diversity indewes are : mean π, π standard deviation, mean Watterson's θ, mean Tajima's D, mean Achaz's Y, Pearson correlation coefficient between genomoc position and π, and p-value of this correlation).

First and foremost, data need to be simulated beforehand to create a big enough dataset in order to train neural networks on different scenarii.

The *simulations* folder contains subfolders each dedicated to the run of different scenarii.
Each subfolder contains the code needed to run simulations for the corresponding scenario.

- *msmscalc_onePop.py* is used to compute genetic statistics (from the ms files) on a sliding window along chromosomes
- *multiple_tree2ms.py* is used to convert .trees files (generated by SLiM) to ms format
- *rand_s_ref_simu.py* is used to sublaunch *reference_simulations.slim* on python to handle the .trees files directly on the fly (recapitation + adding neutral mutations)
- *reference_simulations.slim* is the core file ; it contains the SLiM code used to run the "forward part" of the simulations
- *simulation_sweep.bash* could be seen as both the "main" file and a "parameters" file ; it's the file to run in order to initiate the pipeline

___

## How to set parameters

For now, setting parameters is done by editing :

- *simulation_sweep.bash* (line 10) : python ${projectPath}/rand_s_ref_simu.py Ne=3000 nb_rep=5 r=1e-8 mu=1e-7 L=49999 path=${projectPath}
- *simulation_sweep.bash* (line 34) : python ${projectPath}/msmscalc_onePop.py ${file} 40 1 50000 0.1 0.1 #40 haploids, 1 pop, L=50000, window_size=0.1.L, step=0.1.L

___

## Pipeline output

For now, the pipeline should output the results as below (considering that *simulation_swep.bash* was executed on March 17th 2021, from the **scripts** folder) :

```
project 
│
└───scripts
│   │   msmscalc_onePop.py
│   │   multiple_tree2ms.py
│   │   rand_s_ref_simu.py
│   │   reference_simulations.slim
│   │   simulation_sweep.bash
│   
└───simu_17_Mar_2021
    │   clock.txt
    │   ms_sweep_SLiM_Ne3000_s0.06512_r1e-08_mu1e-07_L49999_positions.txt
    │   ms_sweep_SLiM_Ne3000_s0.06512_r1e-08_mu1e-07_L49999_sumStats.txt
    │   ms_sweep_SLiM_Ne3000_s0.06512_r1e-08_mu1e-07_L49999.trees.txt
    │   (...)
    │   summary_sweep_data.txt
    │   sweep_data_Ne3000_s0.06512_r1e-08_mu1e-07_L49999.txt
    │   sweep_SLiM_Ne3000_s0.06512_r1e-08_mu1e-07_L49999.trees
    │   (...)
```
